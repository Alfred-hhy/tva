# TVA 快速入门指南

## 5分钟快速上手

### 1. 安装依赖

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y build-essential cmake pkg-config libsodium-dev libopenmpi-dev
```

### 2. 编译项目

```bash
# 克隆项目后
cd tva
mkdir build && cd build
cmake ..
make main
```

### 3. 运行第一个程序

```bash
# 运行主程序（3个计算方）
mpirun -np 3 ./main
```

### 4. 运行测试

```bash
# 编译并运行原语测试
make test_primitives
mpirun -np 3 ./test_primitives
```

---

## 第一个安全计算程序

创建文件 `my_first_secure_program.cpp`：

```cpp
#include "../include/tva.h"

using namespace tva::service::mpi_service::replicated_3pc;

int main(int argc, char** argv) {
    // 初始化
    tva_init(argc, argv);
    auto pID = runTime.getPartyID();
    
    // 创建明文数据（只有 Party 0 有真实数据）
    tva::Vector<int> my_data = {10, 20, 30, 40, 50};
    
    // 秘密共享（所有方都执行）
    ASharedVector<int> shared_data = secret_share_a(my_data, 0);
    
    // 安全计算：每个元素乘以2
    ASharedVector<int> result = shared_data * 2;
    
    // 打开结果（所有方都能看到）
    tva::Vector<int> opened_result = result.open();
    
    // 只让 Party 0 打印结果
    if (pID == 0) {
        std::cout << "Result: ";
        for (int i = 0; i < opened_result.size(); i++) {
            std::cout << opened_result[i] << " ";
        }
        std::cout << std::endl;
    }
    
    MPI_Finalize();
    return 0;
}
```

编译运行：
```bash
# 在 CMakeLists.txt 中添加这个文件，或手动编译
g++ -O3 -pthread -std=c++14 my_first_secure_program.cpp \
    -I/usr/include/mpi -lmpi -lsodium -o my_program
    
mpirun -np 3 ./my_program
```

---

## 常用操作速查

### 秘密共享

```cpp
// 算术共享
ASharedVector<int> a_shared = secret_share_a(data, 0);

// 布尔共享
BSharedVector<int> b_shared = secret_share_b(data, 0);
```

### 算术运算

```cpp
ASharedVector<int> sum = a + b;        // 加法
ASharedVector<int> diff = a - b;       // 减法
ASharedVector<int> prod = a * b;       // 乘法
ASharedVector<int> quot = a.div(8);    // 除以常数
```

### 比较运算

```cpp
BSharedVector<int> gt = a > b;         // 大于
BSharedVector<int> eq = a == b;        // 等于
BSharedVector<int> ge = a >= b;        // 大于等于
```

### 位运算

```cpp
BSharedVector<int> and_result = a & b;  // AND
BSharedVector<int> or_result = a | b;   // OR
BSharedVector<int> xor_result = a ^ b;  // XOR
BSharedVector<int> not_result = ~a;     // NOT
```

### 打开秘密

```cpp
tva::Vector<int> plaintext = shared.open();
```

---

## 运行示例查询

```bash
cd build

# 医疗数据查询
make medical
mpirun -np 3 ./medical 16 1 8192 1024

# 能源数据查询
make energy
mpirun -np 3 ./energy 16 1 8192 1024

# 云计算查询
make cloud
mpirun -np 3 ./cloud 16 1 8192 1024
```

---

## 下一步

1. 阅读 `TVA项目详细说明文档.md` 了解完整内容
2. 查看 `tests/` 目录中的测试代码
3. 研究 `src/queries/` 中的示例查询
4. 尝试修改示例代码实现自己的安全计算

---

## 常见问题

**Q: 为什么需要3个进程？**  
A: TVA 使用3方安全计算协议，需要3个计算方。

**Q: 如何查看中间结果？**  
A: 使用 `.open()` 方法打开秘密共享的值。

**Q: 性能如何优化？**  
A: 调整线程数、批大小等参数，详见完整文档第六章。

**Q: 支持哪些数据类型？**  
A: 主要支持整数类型（int, int32_t, int64_t 等）。

---

**需要帮助？** 查看完整文档或项目 README.md

